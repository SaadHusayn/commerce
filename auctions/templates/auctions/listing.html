{% extends "auctions/layout.html" %}

{% block body %}
<h1>Listing: {{listing.title}}</h1>
{% if user.is_authenticated %}
    <form action="{% url 'auctions:watchlist' %}" method="POST">
        {% csrf_token %}
        <input type="hidden" name="listing_id" value="{{listing.id}}">
        {% if watchlisted %}
            <input type="hidden" name="pleaseWatchlist" value="0">
            <input type="submit" value="Remove From Watchlist">
        {% else %}
        <input type="hidden" name="pleaseWatchlist" value="1">
        <input type="submit" value="Watchlist">
        {% endif %}
    </form>
{% endif %}
<img src="{{listing.image.url}}" alt="{{listing.title}}">
<h5>{{listing.description}}</h5>

{% if listing.isListingOpen %}

    <h5>{{listing.bidCurrentPrice}}</h5>

    {% if user.is_authenticated %}

        {% if creatorIsViewingTheList %}

            <form action="{% url 'auctions:listing' listing.id %}" method="post">
                {% csrf_token %}
                <input type="submit" value="Close">
                <input type="hidden" name="isBidingForm" value="0">
            </form>

        {% else %}

            <form action="{% url 'auctions:listing' listing.id%}" method="post">
                {% csrf_token %}
                <input type="hidden" name="isBidingForm" value="1">
                
                {% if currentBidder %}
                    <p>{{numBids}} bid(s) so far. {{currentBidder}} bid is the current bid</p>
                {% else %}
                    <p>{{numBids}} bid(s) so far.</p>
                {% endif %}
                

                <input type="number" min="0" step="0.01" name="bidPrice" placeholder="Bid">

                {% if message %}
                    {{message}}
                {% endif %}
                 
                <input type="submit" value="Place Bid">
            </form>
        {% endif %}
    
    {% else %}

    <a href="{% url 'auctions:login' %}">Login to place bid on this listing.</a>

    {% endif %}
    
{% else %}

    {% if listing.winner %}

        {% if listing.winner == request.user %}
            <p>Listing Closed at {{ listing.bidCurrentPrice }} with {{ numBids }} bid(s). You are the winner of this auction.</p>
        {% else %}
            <p>Listing Closed at {{ listing.bidCurrentPrice }} with {{ numBids }} bid(s). {{ listing.winner }} is the winner of this auction.</p>
        {% endif %}

    {% else %}
        <p>Listing Closed at {{ listing.bidCurrentPrice }} with {{ numBids }} bid(s).</p>
    {% endif %}

{% endif %}

<h5>Details</h5>

<li>Listed by: {{ listing.lister }}</li>
{% if listing.category %}
   <li>Category:  <a href="{% url 'auctions:categoryListings' listing.category %}">{{listing.category}}</a></li>
{% else %}
    <li>Category: No Category Listed</li>
{% endif %}
<li>Created On: {{listing.time}}</li>

<h5>Comments:</h5>
{% for comment in comments %}
	
	<p>{{comment.writer}} on {{comment.time}}:</p>
	<p>{{comment.content}}</p>
	
{% empty %}
	(No Comments on this listing so far.)
{% endfor %}

{% if user.is_authenticated %}
	<form action="{% url 'auctions:saveComment' listing.id %}" method="post">
		{% csrf_token %}
		<input type="text" name="comment" placeholder="Write Comment">
		<input type="submit" value="Save">
	</form>
{% else %}
	<a href="{% url 'auctions:login' %}">Login to write Comment on this listing.</a>
{% endif %}

{% endblock %}